# 以太坊虚拟机
## 简介📖
以太坊虚拟机或EVM是以太坊中智能合约的运行时环境。它不仅是沙箱的，而且实际上是完全隔离的，这意味着在EVM内部运行的代码无法访问网络、文件系统或其他进程。智能合约甚至对其他智能合约有有限的访问权限。

## 账户👛
以太坊中有两种账户共享相同的地址空间:外部账户由公私钥对(即人)控制，合同账户由与账户一起存储的代码控制。

外部账户的地址是由公钥确定的，而合约的地址是在合约创建时确定的(它源于创建者的地址和从该地址发送的交易数量，即所谓的“nonce”)。

无论帐户是否存储代码，EVM都会平等地对待这两种类型。

每个帐户都有一个持久的键值存储，将256位单词映射到称为storage的256位单词。

此外，每个帐户在Ether中都有一个余额(确切地说，在“Wei”中，1 Ether是10**18 Wei)，可以通过发送包含Ether的交易来修改该余额。

## 交易📈
事务是从一个帐户发送到另一个帐户的消息(可能是相同的或空的，请参阅下面)。它可以包括二进制数据(称为“有效负载”)和Ether。

如果目标帐户包含代码，则执行该代码，并提供有效负载作为输入数据。

如果没有设置目标帐户(该事务没有收件人或收件人被设置为null)，则该事务将创建一个新契约。如前所述，该合同的地址不是零地址，而是由发送方及其发送的交易数量派生的地址(即“现在”)。这样一个契约创建事务的有效负载被视为EVM字节码并执行。这次执行的输出数据被永久存储为合同代码。这意味着为了创建合同，您不发送合同的实际代码，而是在执行时返回该代码的实际代码。

创建契约时，它的代码仍然是空的。因此，在构造函数完成执行之前，您不应该回调正在构建的契约。

## 燃料⛽️

在创建时，每笔交易都被收取一定数量的天然气费用，这笔费用必须由交易的发起者(tx.origin)支付。当EVM执行交易时，气体将根据特定规则逐渐耗尽。如果气体在任何点耗尽(例如，它可能是负的)，一个out- gas异常会被触发，结束执行并恢复当前调用帧中所有的修改。

这种机制鼓励经济地使用EVM执行时间，并对EVM执行者(即矿工/股东)的工作进行补偿。由于每个块都有最大的气体量，它也限制了验证块所需的工作量。

汽油价格是由交易发起者设定的值，他必须预先向EVM执行者支付gas_price *汽油。如果在执行后还剩下一些gas，则将其退还给事务发起者。在恢复更改的例外情况下，已经用完的汽油不会退还。

由于EVM执行器可以选择是否包含交易，所以交易发送者不能通过设置低价来滥用系统。

## 存储🏦
